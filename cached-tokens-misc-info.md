# Comprehensive Technical Explanation of Claude Code Token Tracking System

Based on official documentation, here is an exhaustive breakdown of every token-related key in Claude Code ~/.claude/ directory.

---

## Part 1: API-Level Token Keys (snake_case from Claude API Response)

### Input/Output Token Pair

**input_tokens** (snake_case)
- Total tokens consumed AFTER the last prompt cache breakpoint
- Charged at base rate ($3/M for Sonnet 4.5)
- UNDERREPRESENTS total input when caching is active

**output_tokens** (snake_case)
- Tokens generated by Claude including thinking tokens
- Charged at 5x input rate ($15/M for Sonnet 4.5)

### Prompt Caching Input Tokens

**cache_creation_input_tokens** (snake_case)
- Tokens WRITTEN to cache (cache miss)
- 125% of input rate ($3.75/M) for 5m TTL
- 200% of input rate ($6/M) for 1h TTL

**cache_read_input_tokens** (snake_case)
- Tokens retrieved FROM cache (cache hit)
- 10% of input rate ($0.30/M) - 90% discount!

### Ephemeral Cache Tiers

**ephemeral_5m_input_tokens** - 5-minute TTL cache (1.25x write cost)
**ephemeral_1h_input_tokens** - 1-hour TTL cache (2x write cost)

### Service Metadata

**service_tier** - Account tier (1-4), determines rate limits

---

## Part 2: Server Tool Usage Keys

**web_search_requests** - Web search API calls count
**web_fetch_requests** - URL fetch API calls count

---

## Part 3: Stats Cache Aggregates (camelCase)

**inputTokens** - SUM of input_tokens
**outputTokens** - SUM of output_tokens (5x cost)
**cacheReadInputTokens** - SUM of cache reads
**cacheCreationInputTokens** - SUM of cache writes
**costUSD** - Estimated USD cost
**contextWindow** - Max context size
**maxOutputTokens** - Max response tokens
**dailyModelTokens** - Per-day breakdown
**tokensByModel** - Breakdown by model

---

## Part 4: Other Token Keys

**max_tokens** - Max output parameter
**totalTokens** - Sum of all tokens
**token_estimate** - Pre-processing estimate
**tokens_used** - Session total
**tokensSaved** - Cache savings
**preTokens** - Context prep tokens

---

## Part 5: Extended Thinking

- Thinking tokens count as output_tokens
- Billed at output rate
- MAX_THINKING_TOKENS=8000 to reduce

---

## Part 6: API to Stats Mapping

| API Response | Stats Cache |
|--------------|-------------|
| input_tokens | inputTokens |
| output_tokens | outputTokens |
| cache_creation_input_tokens | cacheCreationInputTokens |
| cache_read_input_tokens | cacheReadInputTokens |

---

## Part 7: Billing (Sonnet 4.5)

- Input: $3/M
- Output: $15/M (5x)
- Cache write 5m: $3.75/M (1.25x)
- Cache write 1h: $6/M (2x)
- Cache read: $0.30/M (90% off!)

---

## Part 8: What Governs cache_control

**Entirely opt-in at API level.**

Controls:
- Placement of markers
- TTL: 5m or 1h
- Up to 4 breakpoints
- Min tokens: Sonnet 1024, Opus/Haiku 4096

Env vars (API only):
- DISABLE_PROMPT_CACHING
- DISABLE_PROMPT_CACHING_HAIKU
- DISABLE_PROMPT_CACHING_SONNET
- DISABLE_PROMPT_CACHING_OPUS

**Max subscription: No caching available. Needs API key.**

---

## Part 9: Complete Usage Object

Fields:
- input_tokens: Non-cached input
- output_tokens: Generated + thinking
- cache_creation_input_tokens: Cache writes
- cache_read_input_tokens: Cache reads
- cache_creation.ephemeral_5m_input_tokens: 5m writes
- cache_creation.ephemeral_1h_input_tokens: 1h writes
- service_tier: Account tier
- server_tool_use.web_search_requests: Searches
- server_tool_use.web_fetch_requests: Fetches
